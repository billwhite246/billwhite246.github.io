<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Centos6.10服务器入侵-&gt;重装-&gt;恢复记录 | Bill's blog</title><meta name="description" content="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"><meta name="keywords" content="centos6.10"><meta name="author" content="Bill"><meta name="copyright" content="Bill"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="http://ta.qq.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"><meta name="twitter:description" content="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309201021.png"><meta property="og:type" content="article"><meta property="og:title" content="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"><meta property="og:url" content="http://blog.webpro.ltd/2020/02/22/My-Server-Attacked-by-Scanner/"><meta property="og:site_name" content="Bill's blog"><meta property="og:description" content="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309201021.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '2'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://blog.webpro.ltd/2020/02/22/My-Server-Attacked-by-Scanner/"><link rel="prev" title="My Hexo Blog" href="http://blog.webpro.ltd/2020/03/05/My-Hexo-Blog/"><link rel="next" title="How To Use Git" href="http://blog.webpro.ltd/2020/02/10/how-to-use-git/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script src="https://tajs.qq.com/stats?sId=66527705" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: document.domain == 'billwhite246.gitee.io' ? '/my-blog' : '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#232323","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Bill's blog" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Bill's blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-list-ul"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-calendar-o"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder" aria-hidden="true"></i><span> AHUT</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/03/12/unix-study/"><i class="fa-fw fa fa-file-pdf-o"></i><span> UNIX网络编程作业本</span></a></li><li><a class="site-page" href="/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 2019-07-13实习培训(Python)</span></a></li><li><a class="site-page" href="/%E5%AF%BC%E5%B8%88%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 导师项目学习</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder" aria-hidden="true"></i><span> 文件夹</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="https://www.webpro.ltd/blog/static/arduino-esp8266-latest/" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> ESP8266核心文档</span></a></li><li><a class="site-page" href="/2019/09/29/study-datastructure/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/sims/"><i class="fa-fw fa fa-file-pdf-o"></i><span> sims项目参数</span></a></li><li><a class="site-page" href="https://cdn.jsdelivr.net/gh/billwhite246/billwhite246.github.io@master/pan/pdf/Android开发规范.pdf" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> Android开发规范</span></a></li><li><a class="site-page" href="https://cdn.jsdelivr.net/gh/billwhite246/billwhite246.github.io@master/pan/pdf/java开发规范.pdf" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> java开发规范</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-book" aria-hidden="true"></i><span> 文章</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">18</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-list-ul"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-calendar-o"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder" aria-hidden="true"></i><span> AHUT</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/03/12/unix-study/"><i class="fa-fw fa fa-file-pdf-o"></i><span> UNIX网络编程作业本</span></a></li><li><a class="site-page" href="/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 2019-07-13实习培训(Python)</span></a></li><li><a class="site-page" href="/%E5%AF%BC%E5%B8%88%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 导师项目学习</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-folder" aria-hidden="true"></i><span> 文件夹</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="https://www.webpro.ltd/blog/static/arduino-esp8266-latest/" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> ESP8266核心文档</span></a></li><li><a class="site-page" href="/2019/09/29/study-datastructure/"><i class="fa-fw fa fa-file-pdf-o"></i><span> 数据结构</span></a></li><li><a class="site-page" href="/sims/"><i class="fa-fw fa fa-file-pdf-o"></i><span> sims项目参数</span></a></li><li><a class="site-page" href="https://cdn.jsdelivr.net/gh/billwhite246/billwhite246.github.io@master/pan/pdf/Android开发规范.pdf" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> Android开发规范</span></a></li><li><a class="site-page" href="https://cdn.jsdelivr.net/gh/billwhite246/billwhite246.github.io@master/pan/pdf/java开发规范.pdf" target="_blank" rel="noopener"><i class="fa-fw fa fa-file-pdf-o"></i><span> java开发规范</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-book" aria-hidden="true"></i><span> 文章</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Centos6-10服务器入侵-gt-重装-gt-恢复记录"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Centos6.10服务器入侵-&gt;重装-&gt;恢复记录</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#一、备份WEB站点（root账户）"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">一、备份WEB站点（root账户）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#二、备份MySQL数据库（root账户）"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">二、备份MySQL数据库（root账户）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#三、备份tomcat9、gitea（git账户）"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">三、备份tomcat9、gitea（git账户）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#四、备份root账户下的frp内网穿透软件（root）"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">四、备份root账户下的frp内网穿透软件（root）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#五、重装系统"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">五、重装系统</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#六、恢复服务器环境及功能"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">六、恢复服务器环境及功能</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#卸载旧版本git"><span class="toc_mobile_items-number">1.6.1.</span> <span class="toc_mobile_items-text">卸载旧版本git</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#安装依赖库"><span class="toc_mobile_items-number">1.6.2.</span> <span class="toc_mobile_items-text">安装依赖库</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#下载安装libiconv"><span class="toc_mobile_items-number">1.6.3.</span> <span class="toc_mobile_items-text">下载安装libiconv</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#下载安装Git"><span class="toc_mobile_items-number">1.6.4.</span> <span class="toc_mobile_items-text">下载安装Git</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#检查版本号"><span class="toc_mobile_items-number">1.6.5.</span> <span class="toc_mobile_items-text">检查版本号</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#七、服务器安全性增强设置"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">七、服务器安全性增强设置</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Centos6-10服务器入侵-gt-重装-gt-恢复记录"><span class="toc-number">1.</span> <span class="toc-text">Centos6.10服务器入侵-&gt;重装-&gt;恢复记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、备份WEB站点（root账户）"><span class="toc-number">1.1.</span> <span class="toc-text">一、备份WEB站点（root账户）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、备份MySQL数据库（root账户）"><span class="toc-number">1.2.</span> <span class="toc-text">二、备份MySQL数据库（root账户）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、备份tomcat9、gitea（git账户）"><span class="toc-number">1.3.</span> <span class="toc-text">三、备份tomcat9、gitea（git账户）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、备份root账户下的frp内网穿透软件（root）"><span class="toc-number">1.4.</span> <span class="toc-text">四、备份root账户下的frp内网穿透软件（root）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、重装系统"><span class="toc-number">1.5.</span> <span class="toc-text">五、重装系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、恢复服务器环境及功能"><span class="toc-number">1.6.</span> <span class="toc-text">六、恢复服务器环境及功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#卸载旧版本git"><span class="toc-number">1.6.1.</span> <span class="toc-text">卸载旧版本git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装依赖库"><span class="toc-number">1.6.2.</span> <span class="toc-text">安装依赖库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载安装libiconv"><span class="toc-number">1.6.3.</span> <span class="toc-text">下载安装libiconv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载安装Git"><span class="toc-number">1.6.4.</span> <span class="toc-text">下载安装Git</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查版本号"><span class="toc-number">1.6.5.</span> <span class="toc-text">检查版本号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、服务器安全性增强设置"><span class="toc-number">1.7.</span> <span class="toc-text">七、服务器安全性增强设置</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309201021.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Centos6.10服务器入侵-&gt;重装-&gt;恢复记录</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-22<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-03-09</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Centos6-10服务器入侵-gt-重装-gt-恢复记录"><a href="#Centos6-10服务器入侵-gt-重装-gt-恢复记录" class="headerlink" title="Centos6.10服务器入侵-&gt;重装-&gt;恢复记录"></a>Centos6.10服务器入侵-&gt;重装-&gt;恢复记录</h1><ul>
<li>头些天在centos6.10服务器创建了一个git账户用来搭建私有Git仓库，账户和密码均为git，并且支持ssh密码远程连接，很快被黑客扫描到，通过ssh弱口令进到我的git账户，并操纵我的服务器扫描其他持续扫描其他服务器，被购买服务器的主机商的防火墙发现，锁定了我的服务器。也是在与客服的沟通中，他问我的服务器ssh密码是否过于简单，正是弱口令使我的服务器沦陷。病毒已经植入到我的系统中，为了彻底解决，客服建议我重装系统，尽管服务器上面的数据比较多，我还是硬着头皮备份、重装了一次系统，搞了整整一天，服务器上的功能基本恢复。</li>
</ul>
<p><a href="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123405.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123405.png" class="lazyload"></a></p>
<ul>
<li>上一次配置服务器还是在2年前，当时安全意识较差，认为防火墙是多余的，把防火墙直接关闭，使得服务器上可以任意向外发送数据、服务器上的任何端口都向外开放；很多程序都放到root账户下运行；为了省事，设置及其简单的密码，每当看到网络安全相关资料讲解“弱口令”时，感觉弱口令离我非常遥远，不以为然。这些做法都是极其危险的，也是一步一步使我服务器沦陷的最终原因。</li>
</ul>
<h2 id="一、备份WEB站点（root账户）"><a href="#一、备份WEB站点（root账户）" class="headerlink" title="一、备份WEB站点（root账户）"></a>一、备份WEB站点（root账户）</h2><ul>
<li><p>我安装的WEB服务软件为国产的Kangle服务器，应该很少有人听说，Kangle就相当于平时我们所常见的Apache、Nginx，也是一款能够提供WEB访问控制服务的软件。</p>
</li>
<li><p>Kangle站点文件存放在<code>/home/ftp</code>下，Kangle一些相关的账户配置信息存储在<code>/vhs/kangle/etc</code>，首先备份这两个文件夹，然后下载压缩包到本地：</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/ftp</span><br><span class="line">zip -r ftp.zip ftp</span><br><span class="line"><span class="built_in">cd</span> /vhs/kangle/etc/</span><br><span class="line">zip -r etc.zip etc</span><br></pre></td></tr></table></figure></div>

<h2 id="二、备份MySQL数据库（root账户）"><a href="#二、备份MySQL数据库（root账户）" class="headerlink" title="二、备份MySQL数据库（root账户）"></a>二、备份MySQL数据库（root账户）</h2><ul>
<li><p>备份MySQL可以使用Navicat以root账户的身份登陆，导出所有数据库即可（安全起见，MySQL在默认状态是不允许从外网以root账户远程连接，在备份的时候需要手动设置将localhst改成%）。</p>
</li>
<li><p>MySQL配置允许远程连接</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入MySQL</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到mysql库</span></span><br><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看用户表</span></span><br><span class="line">SELECT `Host`,`User` FROM user;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新用户表</span></span><br><span class="line">UPDATE user SET `Host` = <span class="string">'%'</span> WHERE `User` = <span class="string">'用户名'</span> LIMIT 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制刷新权限</span></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭mysql</span></span><br><span class="line"><span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><p>如果你安装了phpmyadmin也可以以root身份登陆管理页面，导出数据库。</p>
</li>
<li><p>我在服务器上设置了定时任务，即每天01:00将整个数据库备份一次，永久保存在服务器上，恰好今天在重装系统前没有对数据库再进行修改，于是我直接使用了今天凌晨1点的全备份来恢复系统。尽管安装系统时仅格式化系统盘，但是为了安全起见，我把sql备份文件下载到了本地。</p>
</li>
</ul>
<h2 id="三、备份tomcat9、gitea（git账户）"><a href="#三、备份tomcat9、gitea（git账户）" class="headerlink" title="三、备份tomcat9、gitea（git账户）"></a>三、备份tomcat9、gitea（git账户）</h2><ul>
<li>git账户下运行着tomcat和gitea(开源git仓库面板，轻量级)，将这两个相关的文件全部压缩，下载。</li>
</ul>
<h2 id="四、备份root账户下的frp内网穿透软件（root）"><a href="#四、备份root账户下的frp内网穿透软件（root）" class="headerlink" title="四、备份root账户下的frp内网穿透软件（root）"></a>四、备份root账户下的frp内网穿透软件（root）</h2><ul>
<li>第三步忘记了备份内网穿透，再次切换到root用户，找到frp的安装位置，压缩，下载：</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">zip -r frp.zip frp</span><br></pre></td></tr></table></figure></div>

<h2 id="五、重装系统"><a href="#五、重装系统" class="headerlink" title="五、重装系统"></a>五、重装系统</h2><p><a href="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123407.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123407.png" class="lazyload"></a></p>
<ul>
<li>仍然选择centos6.10，并仅格式化系统盘，手机验证码确认，重装。大概5分钟，系统重装完成.（实际这里第一次重装系统时我选的centos7，但是装完之后发现centos7与centos6之间的操作还是存在一定差异的，用着不顺手，就又重装了一次，装回了centos6）</li>
</ul>
<h2 id="六、恢复服务器环境及功能"><a href="#六、恢复服务器环境及功能" class="headerlink" title="六、恢复服务器环境及功能"></a>六、恢复服务器环境及功能</h2><ul>
<li>由于重装系统时保留了数据盘，因此重装完毕之后。/home目录下的文件夹并没有清空。众所周知，Linux一般是一个账户对应一个/home目录下的文件夹，我们应先把这些目录清理干净，防止造成冲突。</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除git用户</span></span><br><span class="line">userdel git</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>设置ssh，允许远程连接。我的服务器重装完毕后已经配置好ssh，直接连接即可。</p>
</li>
<li><p>重装Kangle服务器，恢复站点数据（FTP站点及服务器参数配置文件）。</p>
</li>
<li><p>重装MySQL，恢复MySQL数据：</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p mysql &gt; /backup/20200222.sql</span><br></pre></td></tr></table></figure></div>

<hr>
<ul>
<li>安装git(version &gt;= 2.16)</li>
</ul>
<h3 id="卸载旧版本git"><a href="#卸载旧版本git" class="headerlink" title="卸载旧版本git"></a>卸载旧版本git</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove git</span><br></pre></td></tr></table></figure></div>

<h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel</span><br><span class="line">yum install  gcc perl-ExtUtils-MakeMaker</span><br></pre></td></tr></table></figure></div>

<h3 id="下载安装libiconv"><a href="#下载安装libiconv" class="headerlink" title="下载安装libiconv"></a>下载安装libiconv</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">wget https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.15.tar.gz</span><br><span class="line">tar -zxvf libiconv-1.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libiconv-1.15</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/libiconv  &amp;&amp;  make  &amp;&amp; make install</span><br></pre></td></tr></table></figure></div>

<h3 id="下载安装Git"><a href="#下载安装Git" class="headerlink" title="下载安装Git"></a>下载安装Git</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.11.0.tar.gz</span><br><span class="line">tar -zxvf git-2.11.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> git-2.11.0</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/git-2.11.0 --with-iconv=/usr/<span class="built_in">local</span>/libiconv</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></div>

<h3 id="检查版本号"><a href="#检查版本号" class="headerlink" title="检查版本号"></a>检查版本号</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure></div>

<p><a href="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123406.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123406.png" class="lazyload"></a></p>
<hr>
<ul>
<li>安装jdk1.8。我安装的系统位centos6.10 x64，安装jdk1.8。具体版本号为：jdk-8u201-linux-x64.tar.gz。由于已经在本地存过jdk，直接通过SSH上传到/usr/local中：</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u201-linux-x64.tar.gz</span><br><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在profile文件中追加如下文本：</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jdk8 env</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/dev/jdk1.8.0_201</span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH JAVA_HOME CLASSPATH</span><br></pre></td></tr></table></figure></div>

<ul>
<li>保存退出，使环境变量生效：</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></div>

<hr>
<ul>
<li><p>升级内核。centos6.10的默认内核版本是2.x，但是gitea内核版本要求在3.x，所以需要升级内核。</p>
</li>
<li><p>查看当前内核版本</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查看当前系统相关信息(内核版本号、硬件架构、主机名称和操作系统类型等)</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure></div>

<ul>
<li>导入public key</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure></div>

<ul>
<li>安装ELRepo到CentOS</li>
<li>先要进入后面的网址，<a href="http://elrepo.org/tiki/tiki-index.php" target="_blank" rel="noopener">http://elrepo.org/tiki/tiki-index.php</a> 选择要安装的ELRepo </li>
<li>以下是centos6需要的资源</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure></div>

<ul>
<li>安装 kernel-lt（lt=long-term）</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=elrepo-kernel install kernel<span class="_">-lt</span> -y</span><br></pre></td></tr></table></figure></div>

<ul>
<li>编辑grub.conf文件，修改Grub引导顺序</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/grub.conf</span><br></pre></td></tr></table></figure></div>

<p><a href="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123409.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123409.png" class="lazyload"></a></p>
<ul>
<li><p>因为一般新安装的内核在第一个位置，所以设置default=0，表示启动新内核</p>
</li>
<li><p>重启系统</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure></div>

<ul>
<li>再次查看内核版本，已经升级成<code>4.4.214-1.el6.elrepo.x86_64</code></li>
</ul>
<hr>
<ul>
<li><p>创建git账户，在git账户中恢复tomcat、frp、gitea服务。为了增强密码安全性，我使用KeePass软件生成了一个128位的密码。在git账户中上传备份过的tomcat9、frp、gitea，解压并配置相关文件，启动tomcat、frp、gitea并保持在后台运行。</p>
</li>
<li><p>添加MySQL自动完整备份</p>
</li>
<li><p>在/home/backup/创建autobackupmysql.sh，编辑：</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename=`date +%Y%m%d`</span><br><span class="line">mysqldump -uroot -p密码 --all-databases &gt;/home/backup/<span class="variable">$filename</span>.sql</span><br></pre></td></tr></table></figure></div>

<ul>
<li>添加cron</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">0 1 * * * /home/backup/autobackupmysql.sh</span><br></pre></td></tr></table></figure></div>

<hr>
<h2 id="七、服务器安全性增强设置"><a href="#七、服务器安全性增强设置" class="headerlink" title="七、服务器安全性增强设置"></a>七、服务器安全性增强设置</h2><ul>
<li>主要从以下两方面入手：</li>
</ul>
<ol>
<li>禁止使用ssh密码方式连接，改为ssh证书连接。</li>
<li>配置安全策略较强的iptables策略，将iptables的INPUT,FORWARD,OUTPUT策略全部设置为DROP，即出现在所有进出站服务都要在iptables的INPUT和OUTPUT上添加记录，否则无法访问服务。</li>
</ol>
<ul>
<li>1.修改ssh连接方式，由于我有root和git两个账户，因此需要分别生成私钥。</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">cd ~&#x2F;.ssh</span><br></pre></td></tr></table></figure></div>

<ul>
<li>将公钥设置为服务器的登录公钥</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv id_rsa.pub authorized_keys</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查看私钥并保存到本地</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat id_rsa</span><br></pre></td></tr></table></figure></div>

<ul>
<li>设置ssh，禁止密码登录，改用私钥登录</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改PasswordAuthentication 改为 no，然后重启sshd服务</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure></div>

<ul>
<li>再次连接使用ssh私钥即可直接登陆。其他账户的操作方法同root账户。</li>
</ul>
<hr>
<ul>
<li>2.iptable安全策略，首先将INPUT,FORWARD,OUTPUT策略全部设置为DROP（即白名单模式，不设置默认黑名单）</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>注意，上面的命令，当你执行第一条<em>iptables -P INPUT DROP</em>时，会发现你的ssh连接断开，这就说明第一条配置生效了，剩下的配置需要到主机商后台管理页面使用VNC进行连接操作。</p>
</li>
<li><p>首先开启22端口，允许其出站入站</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables status</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>查看iptables状态，若22端口已添加，那么断开VNC，再到我们的ssh连接软件去操作（ssh终端可以复制粘贴，VNC不能，所以尽快配置好22端口）</p>
</li>
<li><p>首先需要开放本机回环地址（127.0.0.1），即允许本机内互相访问</p>
</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables status</span><br></pre></td></tr></table></figure></div>

<ul>
<li>添加完毕后，我的服务器还需要陆续开放WEB服务所需的80、443s端口、3306数据库端口、允许ICMP包通过（ping）等等</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 443 -j ACCEPT</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -p tcp --dport 3306 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 3306 -j ACCEPT</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -p icmp --icmp-type <span class="built_in">echo</span>-request -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p icmp --icmp-type <span class="built_in">echo</span>-reply -j ACCEPT</span><br><span class="line"></span><br><span class="line">service iptables save</span><br><span class="line">service iptables status</span><br></pre></td></tr></table></figure></div>

<ul>
<li>配置完毕后，重启防火墙</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></div>

<ul>
<li>我的服务器上运行的tomcat、gitea等服务，使用Kangle服务器提供的反向代理进行使用，即代理到127.0.0.1:port，这样更加安全，避免没必要的端口暴露。</li>
</ul>
<p><a href="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123408.png" target="_blank" rel="noopener" data-fancybox="group" data-caption class="fancybox"><img alt title data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308123408.png" class="lazyload"></a></p>
<ul>
<li>这是我的防火墙配置</li>
</ul>
<hr>
<blockquote>
<p>到这里，服务器重装及环境的恢复总算基本完成，下一步就是进行各项功能的测试。这一次的攻击事件也使我加强了对网络安全的认识，计算机网络中无时无刻都在进行这各种扫描、嗅探、入侵，只有我们防护好自己的服务器，滴水不漏，才能保证服务器和数据服务的安全可靠。</p>
</blockquote>
<hr>
<hr>
<blockquote>
<p>常用路径及命令</p>
</blockquote>
<ul>
<li>redis官方下载地址：<a href="http://download.redis.io/releases/" target="_blank" rel="noopener">http://download.redis.io/releases/</a></li>
<li>redis安装——进入到安装目录，直接运行make，然后启动即可</li>
<li>redis安装目录：<code>/usr/local/dev/redis-3.0.5</code></li>
<li>redis启动 <code>nohup /usr/local/dev/redis-3.0.5/bin/redis-server /usr/local/dev/redis-3.0.5/redis.conf &amp;</code></li>
<li>redis测试 <code>/usr/local/dev/redis-3.0.5/bin/redis-cli</code></li>
<li>centos6.10添加开机自启，<code>vi /etc/rc.d/rc.local</code></li>
<li>环境变量文件<code>vi /etc/profile</code>,<code>source /etc/profile</code></li>
<li>如果上面的环境变量文件配置了不生效，则配置<code>vi /etc/bashrc</code>,<code>source /etc/bashrc</code></li>
<li>jdk环境配置，下载压缩包，解压到某一路径，配置profile，保存，使profile生效</li>
<li>springboot部署命令：<code>java -jar -Dspring.profiles.active=test demo-0.0.1-SNAPSHOT.jar</code></li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Bill</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.webpro.ltd/2020/02/22/My-Server-Attacked-by-Scanner/">http://blog.webpro.ltd/2020/02/22/My-Server-Attacked-by-Scanner/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.webpro.ltd">Bill's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/centos6-10/">centos6.10    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309201021.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/05/My-Hexo-Blog/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309200656.png" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308222851.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>My Hexo Blog</span></div></a></div><div class="next-post pull_right"><a href="/2020/02/10/how-to-use-git/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309225002.png" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200308222851.jpg'"><div class="label">下一篇</div><div class="next_info"><span>How To Use Git</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/12/27/work-cmd/" title="开发常用命令笔记"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200312095750.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-27</div><div class="relatedPosts_title">开发常用命令笔记</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var createIssueManually = false == true ? true : false;
var distractionFreeMode = false == true ? true : false;
var gitalk = new Gitalk({
  clientID: document.domain == '' ? 'c61a2752586ce23ef4cb' : '7db6d80f4f95761969f5',
  clientSecret: document.domain == '' ? 'd5b1e214f9a600954b0ae9fac6dcbddb02f484be' : '3e0e2ca6e22e762d50dfd210a50cd5e0a3e473ae',
  repo: 'billwhite246.github.io',
  owner: 'billwhite246',
  admin: 'billwhite246',
  id: md5(decodeURI(location.pathname)),
  createIssueManually: createIssueManually,
  distractionFreeMode: distractionFreeMode,
  language: 'zh-CN',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/billwhite246/myPicBedRepo@master/img/20200309201021.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">Copyright&copy;2017 - 2020 By Bill</div><div class="framework-info"><span id="who_powered"></span></div><div id="wnzz"></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>